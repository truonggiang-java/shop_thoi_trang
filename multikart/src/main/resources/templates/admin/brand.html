<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AdminLTE 3 | Dashboard</title>


<!-- Google Font: Source Sans Pro -->
<link rel="stylesheet"
	th:href="@{https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback}">
<!-- Font Awesome -->
<link rel="stylesheet"
	th:href="@{plugins/fontawesome-free/css/all.min.css}">
<!-- Ionicons -->
<link rel="stylesheet"
	th:href="@{https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css}">
<!-- Tempusdominus Bootstrap 4 -->
<link rel="stylesheet"
	th:href="@{/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">
<!-- iCheck -->
<link rel="stylesheet"
	th:href="@{/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
<!-- JQVMap -->
<link rel="stylesheet" th:href="@{/plugins/jqvmap/jqvmap.min.css}">
<!-- Theme style -->
<link rel="stylesheet" th:href="@{/dist/css/adminlte.min.css}">
<!-- overlayScrollbars -->
<link rel="stylesheet"
	th:href="@{/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
<!-- Daterange picker -->
<link rel="stylesheet"
	href="/plugins/daterangepicker/daterangepicker.css">
<!-- summernote -->
<link rel="stylesheet"
	th:href="@{/plugins/summernote/summernote-bs4.min.css}">

</head>
<body class="sidebar-mini layout-fixed" style="height: auto;">
	<header th:replace="/admin/header.html"></header>
	<div th:replace="/admin/aside.html"></div>
	<div class="content-wrapper" style="max-height: 1690.6px;">
		<!-- Content Header (Page header) -->
		<section class="content-header">
			<div class="container-fluid">
				<div class="row mb-2">
					<div class="col-sm-6">
						<h1>Simple Tables</h1>
					</div>
					<div class="col-sm-6">
						<ol class="breadcrumb float-sm-right">
							<li class="breadcrumb-item"><a href="#">Home</a></li>
							<li class="breadcrumb-item active">Simple Tables</li>
						</ol>
					</div>
				</div>
			</div>
			<!-- /.container-fluid -->
		</section>
		<button class="btn btn-warning" id="add">Thêm mới</button>
		<!-- Main content -->
		<section class="content">
			<div class="container-fluid">
				<!-- /.row -->
				<div class="row">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<h3 class="card-title">Responsive Hover Table</h3>

								<div class="card-tools">
									<div class="input-group input-group-sm" style="width: 150px;">
										<input type="text" class="form-control float-right"
											placeholder="Search">

										<div class="input-group-append">
											<button type="submit" class="btn btn-default">
												<i class="fas fa-search"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
							<!-- /.card-header -->
							<div class="card-body table-responsive p-0">
								<table class="table table-hover text-nowrap">
									<thead>
										<tr>
											<th>ID</th>
											<th>Name</th>
											<th>Slug</th>
											<th>Status</th>
											<th>Image</th>
											<th>Action</th>
										</tr>
									</thead>
									<tbody id="brand">


									</tbody>
								</table>
							</div>
							<!-- /.card-body -->
						</div>
						<!-- /.card -->
					</div>
				</div>
				<!-- /.row -->
			</div>
			<!-- /.container-fluid -->
		</section>
		<!-- /.content -->
	</div>
	<div id="modal" class="modal fade bd-example-modal-lg" tabindex="-1"
		role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="card card-primary">
					<div class="card-header">
						<h3 class="card-title">Quick Example</h3>
					</div>
					<!-- /.card-header -->
					<!-- form start -->
					<form id="formModal">
						<div class="card-body">
							<div id="errors"></div>
							<div class="form-group">
								<input type="hidden" name="brandId" value="" /> <label
									for="name">Name</label> <input type="text" class="form-control"
									id="name" placeholder="Tên danh mục" />

							</div>
							<div>
								<label for="image">Image</label> <input type="file" id="image"
									name="image">
							</div>
							<div class="form-group">
								<label for="status">Trạng thái</label> <input type="checkbox"
									class="form-control" id="status" name="status" />
							</div>

						</div>
						<!-- /.card-body -->

						<div class="card-footer">
							<button type="submit" class="btn btn-primary">Submit</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<footer th:replace="/admin/footer.html"></footer>
	<!-- jQuery -->
	<script src="/plugins/jquery/jquery.min.js"></script>
	<!-- jQuery UI 1.11.4 -->
	<script src="/plugins/jquery-ui/jquery-ui.min.js"></script>
	<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
	<script>
		$.widget.bridge('uibutton', $.ui.button)
	</script>
	<!-- Bootstrap 4 -->
	<script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- ChartJS -->
	<script src="/plugins/chart.js/Chart.min.js"></script>
	<!-- Sparkline -->
	<script src="/plugins/sparklines/sparkline.js"></script>
	<!-- JQVMap -->
	<script src="/plugins/jqvmap/jquery.vmap.min.js"></script>
	<script src="/plugins/jqvmap/maps/jquery.vmap.usa.js"></script>
	<!-- jQuery Knob Chart -->
	<script src="plugins/jquery-knob/jquery.knob.min.js"></script>
	<!-- daterangepicker -->
	<script src="/plugins/moment/moment.min.js"></script>
	<script src="/plugins/daterangepicker/daterangepicker.js"></script>
	<!-- Tempusdominus Bootstrap 4 -->
	<script
		src="/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
	<!-- Summernote -->
	<script src="/plugins/summernote/summernote-bs4.min.js"></script>
	<!-- overlayScrollbars -->
	<script
		src="/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
	<!-- AdminLTE App -->
	<script src="/dist/js/adminlte.js"></script>
	<!-- AdminLTE for demo purposes -->
	<script src="/dist/js/demo.js"></script>
	<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
	<script src="/dist/js/pages/dashboard.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			var myStorage = window.sessionStorage;
	        var token = sessionStorage.getItem('multikart-token');
			$.ajax({
				headers:{
					'Authorization' : 'Bearer ' + token
				},
				method:"GET",
				url:"http://localhost:8080/api/v1/brands",
				success:function(response){
					
					let html="";
					response.forEach(function(e){
						html+=`
							<tr>
								<td>${e.id}</td>
								<td id="name${e.id}">${e.name}</td>
								<td id="slug${e.id}">${e.slug}</td>
								<td><span id="status${e.id}" class="${e.status === true ? 'badge badge-success' : 'badge badge-danger'}">${e.status === true ? 'Active' : 'Disable'}</span></td>
								<td id="image${e.id}"><img  src="${e.image === null ? 'https://piotrkowalski.pw/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png' : 'http://localhost:8080/logos/'+ e.image }"/></td>
								<td>
									<button id="${e.id}" class="btn btn-warning update" ><i class="fa fa-pen">Update</i></button>
									<button id="${e.id} "class="btn btn-danger delete" ><i class="fa fa-trash">Delete</i></button>
								</td>
							</tr>
						`
						$("#brand").html(html);
					})
				},
				error:function(errors){
					console.log(errors)
				}
			})
			$(document).on("click",".update",function(e){
				e.preventDefault();
				const id=+$(this).attr('id');
				$("#modal").modal('show');
				$.ajax({
					headers:{
						'Authorization' : 'Bearer' + token
					},
					method:"GET",
					url:`http://localhost:8080/api/v1/brands/${id}`,
					success:function(response){
						$("#name").val(response.name);
						$("#image").attr('src',response.image);
						$("status").prop("checked",response.status);
						$("input[name='brandId']").val(id);
						
					},
					error:function(errors){
						console.log(errors);
					}
				})				
			})
			
			$(document).on('click','.delete', function(e){
				e.preventDefault();
				const id=+$(this).attr('id');
				$.ajax({
					headers:{
						'Authorization' : 'Bearer' + token
					},
					method:"DELETE",
					url:`http://localhost:8080/api/v1/brands/${id}`,
					success:function(response){
						Swal.fire({
							  title: 'Are you sure?',
							  text: "You won't be able to revert this!",
							  icon: 'warning',
							  showCancelButton: true,
							  confirmButtonColor: '#3085d6',
							  cancelButtonColor: '#d33',
							  confirmButtonText: 'Yes, delete it!'
							}).then((result) => {
							  if (result.isConfirmed) {
							    Swal.fire(
							      'Deleted!',
							      'Your file has been deleted.',
							      'success'
							    )
							  }
							})
						if(response !=null){
							$.ajax({
								headers:{
									'Authorization' : 'Bearer' + token
								},
								method:"GET",
								url:"http://localhost:8080/api/v1/brands",
								success:function(response){
									
									let html="";
									response.forEach(function(e){
										html+=`
											<tr>
												<td>${e.id}</td>
												<td id="name${e.id}">${e.name}</td>
												<td id="slug${e.id}">${e.slug}</td>
												<td><span id="status${e.id}" class="${e.status === true ? 'badge badge-success' : 'badge badge-danger'}">${e.status === true ? 'Active' : 'Disable'}</span></td>
												<td id="image${e.id}"><img  src="${e.image === null ? 'https://piotrkowalski.pw/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png' : 'http://localhost:8080/logos/'+ e.image }"/></td>
												<td>
													<button id="${e.id}" class="btn btn-warning update" <i class="fa fa-pen"></i></button>
													<button id="${e.id} "class="btn btn-danger delete" <i class="fa fa-trash"></i></button>
												</td>
											</tr>
										`
										$("#brand").html(html);
									})
								},
								error:function(errors){
									console.log(errors)
								}
							})
						}
					},
					error:function(errors){
						console.log(errors);
					}
				})
			})
			let file=null;
			$("#image").change(function(e){ 
				file=e.target.files[0];
			})
			$("#formModal").submit(function(e){
				e.preventDefault();
				const id=+$("input[name='brandId']").val();
				let data= new FormData();
				data.append("id",+$("input[name='brandId']").val() != null ? +$("input[name='brandId']").val() : null);
				data.append("name",$("#name").val());
				data.append("slug",changeToSlug($("#name").val()));
				data.append("image",file);
				data.append("status",$("#status").prop("checked"));
				
				$.ajax({
					headers:{
						'Authorization' : 'Bearer' + token
					},
					contentType: false,
                    processData: false,
                    cache: false,
					method:"POST",
					data:data,
                    url: `http://localhost:8080/api/v1/brands/${+id != null ? +id : ''}`,
					success:function(response){
						const Toast = Swal.mixin({
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        })

                        Toast.fire({
                            icon: 'success',
                            title: 'Signed in successfully'
                        }),
                            $(`#modal`).modal('hide');
						if(response){
							$.ajax({
								method:"GET",
								url:"http://localhost:8080/api/v1/brands",
								success:function(response){
					
								let html="";
								response.forEach(function(e){
									html+=`
										<tr>
											<td>${e.id}</td>
											<td id="name${e.id}">${e.name}</td>
											<td id="slug${e.id}">${e.slug}</td>
											<td><span id="status${e.id}" class="${e.status === true ? 'badge badge-success' : 'badge badge-danger'}">${e.status === true ? 'Active' : 'Disable'}</span></td>
											<td id="image${e.id}"><img  src="${e.image === null ? 'https://piotrkowalski.pw/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png' : 'http://localhost:8080/logos/'+ e.image }"/></td>
											<td>
												<button id="${e.id}" class="btn btn-warning update" <i class="fa fa-pen"></i></button>
												<button id="${e.id} "class="btn btn-danger delete" <i class="fa fa-trash"></i></button>
											</td>
										</tr>
									`
						$("#brand").html(html);
					})
				},
				error:function(errors){
					console.log(errors)
				}
							})
						}
					},
					error:function(errors){
						console.log(errors);
					}
				})
			})
			$(document).on('click','#add',function(e){
				e.preventDefault();
				$("#name").val('');
				$("#image").attr("src","");
				$("#status").prop("checked",true);
				$("input[name='brandId']").val(null);
	            $("#modal").modal('show');
			})
		})
		
	</script>